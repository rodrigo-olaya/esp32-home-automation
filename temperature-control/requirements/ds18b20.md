# DS18B20 Temperature Sensor Requirements

## 1. Overview

This document details requirements specific to the DS18B20 digital temperature sensor, assuming a generic 1-Wire protocol driver is available.

---

## 2. Functional Requirements

### 2.1 Initialization
- Verify device family code is 0x28 (DS18B20)
- Validate ROM address CRC
- Support multiple DS18B20 sensors on the same bus

### 2.2 Temperature Reading
- Send CONVERT_T (0x44) command to start temperature conversion
- Wait for conversion completion (timing based on resolution)
- Read 9-byte scratchpad
- Validate scratchpad CRC
- Extract 16-bit temperature value from bytes 0-1
- Convert raw value to Celsius and Fahrenheit
- Support temperature range: -55°C to +125°C

### 2.3 Resolution
- Default: 12-bit (0.0625°C)
- Support 9, 10, 11, 12-bit resolutions
- Allow configuration per sensor

### 2.4 Error Handling
- Detect and handle CRC errors
- Detect invalid readings (85°C, -127°C)
- Retry failed reads up to 3 times
- Discard invalid readings

### 2.5 Data Management
- Package readings in `sensorData_t` structure
- Include sensor identifier (ROM address or index)
- Send to FreeRTOS queue

---

## 3. Task & Timing
- Reading interval: 5 seconds (configurable)
- Use non-blocking delays
- Task name: `ds18b20_task`

---

## 4. Logging
- Log sensor discovery, ROM addresses, and errors
- Log temperature readings (°C and °F)

---

## 5. Testing
- Unit tests for conversion and CRC
- Integration tests for multi-sensor operation
- Hardware tests for accuracy and error handling

---

## 6. Success Criteria
- Accurate readings within ±0.5°F
- Robust error handling
- Multi-sensor support
- Integration with MQTT and control logic